@startuml Handle CHECKOUT_PAYMENT_CONFIRMED_BY_PROVIDER
title "Handle CHECKOUT_PAYMENT_CONFIRMED_BY_PROVIDER"
box "Payment Service"
    participant "Payment Service" as payment_service
    database "Payment Database" as payment_database
    entity "Checkout Payment" as checkout_payment
end box
queue "KafkaTopic: CheckoutPaymentEvents" as checkout_payment_topic

checkout_payment_topic --> payment_service: Event: CHECKOUT_PAYMENT_CONFIRMED_BY_PROVIDER {checkoutId}
activate payment_service
payment_service -> payment_database: find checkout { checkout_id }
activate payment_database
    payment_database -> checkout_payment **: find checkout_payment
    payment_database --> payment_service: checkout_payment
deactivate payment_database
payment_service -> checkout_payment: update(status=COMPLETED)
payment_service -> payment_database: update(CheckoutPayment)
activate payment_database
payment_database --> payment_service: CheckoutPayment
deactivate payment_database
payment_service -> checkout_payment_topic: Event: CHECKOUT_PAYMENT_COMPLETED {checkout_id}
deactivate payment_service
@enduml