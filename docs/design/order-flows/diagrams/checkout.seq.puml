@startuml Checkout Flow

title Checkout Flow

actor Customer as customer #fad7a0

box YAS 
    participant "Storefront" as storefront #ffffff 
    participant "Order Service" as order_service #3498db
    entity "Shopping Cart" as shopping_cart #3498db
    entity "Checkout" as checkout #3498db
    entity "Order" as order #3498db
    participant "Payment Service" as payment_service #73c6b6
    participant "Shipment Service" as shipment_service #c39bd3
    participant "Inventory Service" as inventory_service #808b96
    participant "Customer Service" as customer_service #fad7a0
end box 

customer -> storefront: Browse cart page
activate storefront #ffffff
customer -> storefront: Update cart quantity
storefront -> order_service: PUT /order/cart/items/{product_id} \n { quantity }
activate order_service #a9cce3
  order_service -> shopping_cart: Update item quantity
deactivate order_service

customer -> storefront: Proceed to checkout
storefront -> order_service: POST /order/checkouts
activate order_service #a9cce3
  order_service -> checkout **: Create Checkout
  order_service <-- checkout
  order_service -> shopping_cart: Clear cart
  storefront <-- order_service: checkout
deactivate order_service
storefront -> customer: Display checkout info
storefront -> payment_service: GET /payment/methods
activate payment_service #73c6b6
  storefront <-- payment_service: payment_methods
deactivate payment_service
storefront -> customer: Display payment methods
customer -> storefront: Pick a payment method

storefront -> shipment_service: GET /shipment/providers
activate shipment_service #c39bd3
  storefront <-- shipment_service: shipment_providers
deactivate shipment_service
storefront -> customer: Display shipment provider
customer -> storefront: Pick a shipment provider

storefront -> customer_service: GET /storefront/addresses
activate customer_service #fad7a0
  storefront <-- customer_service: addresses
deactivate customer_service
customer -> storefront: Pick a shipping address

storefront -> order_service: POST /order/orders { checkout.id, payment_method, shipment_provider, address } 
activate order_service #a9cce3
  order_service -> order **: Create Order
  order_service <-- order: order
  order_service -> inventory_service: POST /inventory/stock { order.id, order.items }
  storefront <-- order_service: order
deactivate order_service
storefront -> customer: confirm and show order info
deactivate storefront
@enduml